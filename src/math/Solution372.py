from typing import Counter
import torch


def test_p(x):
    m = 1337
    print("p1: {}, p1338:{}".format(x % m, (x**1338) % m))


def isCoPrime(a, b):
    temp = 0
    while b != 0:
        temp = b
        b = a % b
        a = temp
    return 1 if a == 1 else 0


def divide(b, m: int):
    new_b = []
    tmp_rest = -1
    for i in range(len(b) - 3):
        if tmp_rest == -1:
            tmp = b[i] * 1000 + b[i + 1] * 100 + 10 * b[i + 2] + b[i + 3]
        else:
            tmp = tmp_rest * 10 + b[i + 3]

        tmp_rest = tmp % m
        tmp_rest_m = tmp // m

        if len(new_b) == 0:
            s = str(tmp_rest_m)
            for c in s:
                new_b.append(int(c))
        else:
            s = str(tmp_rest_m)
            new_b.append(int(s))

    return new_b, tmp_rest


def superPow(a, b) -> int:
    # a = k*1337 + p
    m = 1337
    p = a % m
    count = 1140

    if len(b) == 1 and b[0] == 0:
        return 0

    g_list = [1]
    for i in range(1, m + 1):
        g_list.append((p**i) % m)

    if len(b) == 1:
        return (p ** b[0]) % m
    elif len(b) == 2:
        return (p ** (b[0] * 10 + b[1])) % m
    elif len(b) == 3:
        return (p ** (b[0] * 100 + b[1] * 10 + b[2])) % m
    elif len(b) == 4 and (b[0] * 1000 + b[1] * 100 + 10 * b[2] + b[3]) <= m:
        return (p ** (b[0] * 1000 + b[1] * 100 + 10 * b[2] + b[3])) % m
    else:
        new_b, d_2 = divide(b, count)
        return (1 * g_list[d_2]) % m


if __name__ == "__main__":
    a = 209253
    b = [
        3,
        6,
        4,
        3,
        0,
        7,
        9,
        2,
        9,
        7,
        8,
        7,
        7,
        0,
        3,
        8,
        6,
        0,
        0,
        8,
        0,
        8,
        3,
        4,
        4,
        4,
        9,
        9,
        6,
        7,
        3,
        3,
        6,
        7,
        8,
        6,
        4,
        8,
        8,
        3,
        7,
        9,
        2,
        4,
        1,
        5,
        4,
        9,
        7,
        4,
        8,
        8,
        4,
        3,
        4,
        8,
        9,
        6,
        0,
        6,
        3,
        3,
        1,
        1,
        2,
        1,
        8,
        8,
        1,
        8,
        3,
        8,
        9,
        5,
        4,
        0,
        3,
        9,
        0,
        0,
        5,
        0,
        0,
        0,
        5,
        5,
        0,
        7,
        1,
        0,
        5,
        6,
        5,
        6,
        8,
        9,
        9,
        8,
        7,
        1,
        6,
        0,
        9,
        6,
        8,
        6,
        8,
        1,
        5,
        0,
        3,
        0,
        0,
        4,
        0,
        8,
        1,
        1,
        5,
        2,
        3,
        0,
        0,
        9,
        8,
        8,
        8,
        7,
        6,
        8,
        8,
        5,
        8,
        0,
        3,
        8,
        6,
        3,
        1,
        3,
        4,
        5,
        3,
        6,
        1,
        6,
        4,
        2,
        9,
        9,
        6,
        2,
        1,
        6,
        1,
        9,
        7,
        2,
        7,
        5,
        0,
        7,
        0,
        0,
        9,
        5,
        9,
        7,
        9,
        2,
        0,
        3,
        9,
        4,
        1,
        0,
        0,
        6,
        4,
        9,
        7,
        2,
        3,
        9,
        9,
        5,
        8,
        8,
        9,
        7,
        3,
        9,
        7,
        4,
        9,
        6,
        1,
        0,
        6,
        0,
        3,
        6,
        5,
        4,
        2,
        7,
        5,
        2,
        3,
        1,
        3,
        0,
        4,
        9,
        1,
        5,
        6,
        0,
        3,
        5,
        9,
        6,
        4,
        6,
        2,
        5,
        5,
        4,
        8,
        1,
        4,
        3,
        7,
        2,
        7,
        0,
        9,
        4,
        4,
        4,
        6,
        0,
        6,
        2,
        9,
        8,
        7,
        5,
        0,
        0,
        0,
        9,
        8,
        6,
        6,
        1,
        3,
        1,
        5,
        3,
        2,
        1,
        6,
        1,
        3,
        6,
        1,
        4,
        2,
        6,
        0,
        8,
        8,
        9,
        2,
        7,
        7,
        9,
        4,
        7,
        1,
        4,
        8,
        0,
        2,
        4,
        3,
        5,
        7,
        0,
        1,
        9,
        1,
        7,
        1,
        7,
        5,
        4,
        3,
        8,
        2,
        6,
        8,
        0,
        5,
        1,
        9,
        2,
        2,
        3,
        1,
        6,
        9,
        9,
        8,
        1,
        6,
        1,
        9,
        3,
        1,
        0,
        5,
        4,
        9,
        8,
        3,
        5,
        4,
        7,
        5,
        7,
        3,
        3,
        9,
        8,
        6,
        9,
        2,
        9,
        2,
        5,
        5,
        2,
        6,
        3,
        5,
        2,
        6,
        6,
        8,
        7,
        6,
        5,
        3,
        8,
        5,
        7,
        5,
        9,
        6,
        0,
        8,
        9,
        5,
        8,
        9,
        2,
        7,
        3,
        3,
        1,
        0,
        0,
        5,
        6,
        5,
        3,
        1,
        1,
        9,
        1,
        0,
        6,
        6,
        3,
        6,
        3,
        2,
        1,
        2,
        8,
        1,
        1,
        9,
        8,
        1,
        0,
        2,
        0,
        3,
        5,
        1,
        3,
        7,
        9,
        2,
        2,
        2,
        3,
        3,
        1,
        4,
        3,
        9,
        2,
        9,
        5,
        5,
        1,
        6,
        9,
        0,
        9,
        2,
        9,
        0,
        3,
        0,
        2,
        5,
        5,
        0,
        9,
        1,
        7,
        8,
        3,
        0,
        2,
        8,
        3,
        5,
        4,
        9,
        7,
        6,
        8,
        2,
        3,
        9,
        1,
        4,
        1,
        2,
        9,
        3,
        2,
        4,
        5,
        5,
        0,
        0,
        7,
        9,
        3,
        4,
        9,
        6,
        4,
        1,
        6,
        0,
        8,
        0,
        9,
        5,
        8,
        9,
        0,
        3,
        0,
        1,
        8,
        2,
        5,
        9,
        7,
        0,
        3,
        2,
        7,
        3,
        2,
        4,
        4,
        8,
        8,
        3,
        4,
        3,
        6,
        3,
        3,
        5,
        3,
        4,
        0,
        2,
        5,
        0,
        7,
        5,
        3,
        5,
        9,
        9,
        6,
        6,
        1,
        0,
        8,
        8,
        5,
        3,
        2,
        0,
        1,
        0,
        3,
        7,
        5,
        2,
        0,
        0,
        7,
        4,
        6,
        7,
        8,
        1,
        0,
        5,
        7,
        5,
        3,
        6,
        4,
        9,
        5,
        7,
        1,
        3,
        5,
        7,
        6,
        7,
        9,
        9,
        0,
        4,
        7,
        5,
        6,
        9,
        6,
        3,
        5,
        2,
        3,
        5,
        4,
        5,
        1,
        3,
        0,
        6,
        1,
        7,
        7,
        6,
        4,
        1,
        0,
        0,
        8,
        8,
        7,
        9,
        8,
        7,
        3,
        7,
        5,
        2,
        8,
        3,
        5,
        4,
        5,
        0,
        9,
        1,
        7,
        2,
        6,
        8,
        0,
        8,
        7,
        8,
        4,
        1,
        9,
        6,
        3,
        9,
        5,
        3,
        8,
        5,
        2,
        3,
        4,
        7,
        5,
        2,
        0,
        3,
        6,
        8,
        5,
        8,
        9,
        3,
        0,
        6,
        3,
        1,
        6,
        0,
        1,
        0,
        1,
        2,
        7,
        5,
        1,
        4,
        8,
        1,
        1,
        2,
        6,
        7,
        0,
        2,
        9,
        0,
        7,
        8,
        0,
        2,
        8,
        2,
        7,
        8,
        0,
        0,
        1,
        6,
        0,
        2,
        8,
        4,
        4,
        7,
        1,
        7,
        1,
        1,
        0,
        4,
        3,
        7,
        1,
        3,
        1,
        3,
        6,
        8,
        1,
        8,
        0,
        9,
        0,
        8,
        9,
        0,
        0,
        3,
        6,
        1,
        5,
        5,
        7,
        2,
        2,
        8,
        1,
        6,
        9,
        4,
        0,
        2,
        1,
        4,
        8,
        2,
        7,
        6,
        2,
        0,
        4,
        2,
        1,
        5,
        2,
        0,
        7,
        3,
        3,
        4,
        6,
        1,
        1,
        3,
        5,
        5,
        1,
        8,
        1,
        2,
        2,
        4,
        6,
        5,
        0,
        6,
        7,
        7,
        2,
        9,
        9,
        9,
        4,
        0,
        6,
        8,
        0,
        3,
        3,
        6,
        9,
        1,
        9,
        2,
        4,
        4,
        8,
        7,
        4,
        1,
        1,
        7,
        7,
        8,
        2,
        7,
        4,
        2,
        6,
        9,
        3,
        5,
        0,
        9,
        7,
        6,
        0,
        8,
        1,
        3,
        6,
        1,
        5,
        5,
        5,
        1,
        1,
        5,
        1,
        5,
        7,
        2,
        4,
        6,
        2,
        9,
        6,
        9,
        3,
        4,
        8,
        8,
        2,
        8,
        8,
        9,
        6,
        8,
        7,
        7,
        3,
        5,
        0,
        8,
        0,
        6,
        2,
        3,
        1,
        3,
        1,
        0,
        7,
        5,
        7,
        0,
        6,
        5,
        9,
        9,
        9,
        9,
        8,
        1,
        9,
        8,
        1,
        5,
        6,
        0,
        4,
        1,
        6,
        5,
        2,
        8,
        3,
        4,
        2,
        4,
        9,
        3,
        7,
        6,
        0,
        4,
        8,
        7,
        1,
        9,
        8,
        0,
        8,
        6,
        2,
        9,
        6,
        5,
        4,
        2,
        5,
        1,
        6,
        3,
        6,
        8,
        2,
        9,
        4,
        6,
        5,
        3,
        9,
        2,
        1,
        1,
        8,
        0,
        8,
        9,
        9,
        7,
        2,
        0,
        5,
        6,
        9,
        2,
        1,
        6,
        6,
        8,
        7,
        2,
        2,
        5,
        2,
        6,
        6,
        6,
        2,
        1,
        9,
        3,
        6,
        3,
        4,
        6,
        3,
        5,
        6,
        4,
        2,
        0,
        6,
        9,
        6,
        8,
        1,
        7,
        4,
        0,
        5,
        1,
        4,
        9,
        6,
        7,
        5,
        4,
        3,
        7,
        5,
        5,
        2,
        3,
        8,
        7,
        0,
        3,
        2,
        8,
        9,
        6,
        8,
        6,
        5,
        4,
        4,
        9,
        3,
        0,
        9,
        0,
        1,
        3,
        0,
        9,
        0,
        5,
        3,
        6,
        5,
        0,
        1,
        7,
        6,
        9,
        6,
        6,
        2,
        8,
        6,
        1,
        4,
        6,
        9,
        2,
    ]

    r = superPow(a, b)
    print(r)

    # count = 0
    # for i in range(1, 1337):
    #     if isCoPrime(i, 1337) == 1:
    #         count += 1
    #         print(i)
    # print(count)
    # print((19**count)%1337)
